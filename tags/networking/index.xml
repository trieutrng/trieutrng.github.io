<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Networking on </title>
    <link>https://trieutrng.github.io/tags/networking/</link>
    <description>Recent content in Networking on </description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <managingEditor>trieutrng@gmail.com (Trieu Truong)</managingEditor>
    <webMaster>trieutrng@gmail.com (Trieu Truong)</webMaster>
    <lastBuildDate>Sun, 17 Aug 2025 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://trieutrng.github.io/tags/networking/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>The DNS Protocol</title>
      <link>https://trieutrng.github.io/post/2025/the-dns-protocol/</link>
      <pubDate>Sun, 17 Aug 2025 00:00:00 +0000</pubDate><author>trieutrng@gmail.com (Trieu Truong)</author>
      <guid>https://trieutrng.github.io/post/2025/the-dns-protocol/</guid>
      <description>&lt;p&gt;As an engineer in computer industry, everyone should be familiar with the DNS, how a domain is resolved into IP eventually. Yet not everyone understands how the protocol is defined and how the packet is contructed as well. Thus, this post will go through the DNS packet definition and provide an actual implemetation eventually.&lt;/p&gt;&#xA;&lt;h1 id=&#34;recall-the-dns&#34;&gt;Recall the DNS&lt;/h1&gt;&#xA;&lt;p&gt;&lt;img src=&#34;dns-flow.png&#34; alt=&#34;DNS flow&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;DNS is a hierarchical client-server protocol. Every individual domain (e.g., google.com, microsoft.com, etc) is managed by a DNS server which knows where exactly the machine that running the application and eventually return the IP of that machine.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>As an engineer in computer industry, everyone should be familiar with the DNS, how a domain is resolved into IP eventually. Yet not everyone understands how the protocol is defined and how the packet is contructed as well. Thus, this post will go through the DNS packet definition and provide an actual implemetation eventually.</p>
<h1 id="recall-the-dns">Recall the DNS</h1>
<p><img src="dns-flow.png" alt="DNS flow"></p>
<p>DNS is a hierarchical client-server protocol. Every individual domain (e.g., google.com, microsoft.com, etc) is managed by a DNS server which knows where exactly the machine that running the application and eventually return the IP of that machine.</p>
<p>When we register a domain for an IP, we are always being asked to set up some records such as A, AAAA, CNAME, etc,. So what do those records mean?</p>
<ul>
<li><strong>A</strong>: IPv4 address record</li>
<li><strong>AAAA</strong>: IPv6 address record</li>
<li><strong>MX</strong>: Mail exchange record. This directs mail to an email server</li>
<li><strong>TXT</strong>: Text record. This lets an admin store text notes in the record.</li>
<li><strong>Canonical name</strong>: Canonical name. This is used to forwards one domain or subdomain to another domain, does NOT provide an IP address.</li>
</ul>
<p>And so on, you can keep discovering them at <a href="https://www.cloudflare.com/learning/dns/dns-records/">here</a>.
All the end server in the whole flow communicate by the same protocol to resolve exactly the responsible server.</p>
<p>So how the bytes are formed?</p>
<h1 id="dns-packet-structure">DNS packet structure</h1>
<p><img src="dns-message-format.png" alt="DNS packet structure"></p>
<p>First of all, the the packet begins with a header section, this one describes the entire packet, it contains some data and flags like ID, the type of packet (query or answer) and number of questions or answers based on the type. Receiver side will get understood the header and extract the data of the rest later on.</p>
<p>Next, we have the question section, this bunch of bytes store the question of the request which is domain name to be resolved.</p>
<p>The answer bytes holds the tail of the question section, it is built for the response no matter the response belongs to the TLD server or Authoritative one.</p>
<p>For simplicity, the last 2 sections are Authority and Additional will be skipped for this post.</p>
<h1 id="dns-headers">DNS headers</h1>
<p><img src="dns-header.png" alt="DNS packet structure"></p>
<p>This section of bytes contains 13 fields:</p>
<ul>
<li><strong>ID</strong>: 16 bits value indicates the ID of the message<!-- raw HTML omitted --></li>
<li><strong>QR</strong>: 1 bit for the type of message. 0 for query and 1 for response<!-- raw HTML omitted --></li>
<li><strong>OPCODE</strong>: type of query<!-- raw HTML omitted --></li>
<li><strong>AA</strong>: Indicates an authoritative answer<!-- raw HTML omitted --></li>
<li><strong>TC</strong>: Is this message truncated? Then is should be resent using TCP protocol<!-- raw HTML omitted --></li>
<li><strong>RD</strong>: We leave this bit set to indicate that we
want the DNS server to contact additional servers until it can complete our
request<!-- raw HTML omitted --></li>
<li><strong>RA</strong>: Indicates in a response whether the DNS server supports recursion<!-- raw HTML omitted --></li>
<li><strong>Z</strong>: Is unused and should be set to 0<!-- raw HTML omitted --></li>
<li><strong>RCODE</strong>: The error of the message<!-- raw HTML omitted -->
<img src="dns-rcode.png" alt="DNS RCODE">
<!-- raw HTML omitted --></li>
<li><strong>QDCOUNT</strong>: Number of question entries<!-- raw HTML omitted --></li>
<li><strong>ANCOUNT</strong>: Number of answers records<!-- raw HTML omitted --></li>
<li><strong>NSCOUNT</strong>: Number of records in Authority section<!-- raw HTML omitted --></li>
<li><strong>ARCOUNT</strong>: Number of records in Additional section<!-- raw HTML omitted --></li>
</ul>





<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">int</span> <span class="nf">build_dns_packet</span><span class="p">(</span><span class="k">struct</span> <span class="n">Query</span> <span class="o">*</span><span class="n">query</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">packet</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="c1">// ID
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0xAB</span><span class="p">;</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0xCD</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="c1">// QR=0,OPCODE=0,AA=0,TC=0,RD=1,RA=0,Z=0,RCODE=0
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1">// QDCOUNT = 1
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="c1">// ANCOUNT = 0
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="c1">// QDCOUNT = 0
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="c1">// ARCOUNT = 0
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h1 id="dns-question">DNS question</h1>
<p><img src="dns-question.png" alt="DNS packet questions"></p>
<p>3 fields are described as:</p>
<ul>
<li><strong>NAME</strong>: The querying name that is serialized by a convention<!-- raw HTML omitted --></li>
<li><strong>QTYPE</strong>: Type of the query<!-- raw HTML omitted -->
<img src="dns-question-type.png" alt="DNS question type"></li>
<li><strong>QCLASS</strong>: A two octet code that specifies the class of the query. 0x0001 is indicate the Internet address</li>
</ul>
<h3 id="query-serialization">Query serialization</h3>
<p>The querying domain is specially serialized by some conventions. We first split the domains in to tokens. Each token will be placed into the name section as bytes consecutively and prepended by a 8 bits number which indicates the size of the token.</p>
<p>For example, the domain <a href="https://www.google.com">www.google.com</a> is splitted in to 3 tokens www, google and com. Then, the encoding will look like this:</p>
<p>| 3 | w | w | w | 6 | g | o | o | g | l | e | 3 | c | o | m | 0 |</p>
<p>The last 0 indicates the end of name.</p>





<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">int</span> <span class="nf">build_dns_packet</span><span class="p">(</span><span class="k">struct</span> <span class="n">Query</span> <span class="o">*</span><span class="n">query</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">packet</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">p_size</span> <span class="o">=</span> <span class="n">buf</span><span class="o">++</span><span class="p">,</span> <span class="o">*</span><span class="n">p_char</span> <span class="o">=</span> <span class="n">query</span><span class="o">-&gt;</span><span class="n">domain</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">p_char</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p_char</span> <span class="o">==</span> <span class="sc">&#39;.&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">            <span class="o">*</span><span class="n">p_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">buf</span> <span class="o">-</span> <span class="n">p_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="n">p_size</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="o">*</span><span class="n">p_char</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="n">buf</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="n">p_char</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="o">*</span><span class="n">p_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">buf</span> <span class="o">-</span> <span class="n">p_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>                          <span class="c1">// end name
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">query</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">;</span>    <span class="c1">// QTYPE
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>           <span class="c1">// QCLASS = 1, internet
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h1 id="dns-answer">DNS answer</h1>
<p><img src="dns-answer.png" alt="DNS packet answers"></p>
<p>The 3 fields NAME, TYPE, CLASS have the same format with the questions sections. There are 3 more new fields:</p>
<ul>
<li><strong>TTL</strong>: The time the results can be cached as seconds<!-- raw HTML omitted --></li>
<li><strong>RDLENGTH</strong>: Length of RDATA field<!-- raw HTML omitted --></li>
<li><strong>RDATA</strong>: Data&rsquo;s interpretation is dependent upon the type specified by TYPE</li>
</ul>





<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="nf">resolve_dns_response</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dns_res</span><span class="p">,</span> <span class="kt">int</span> <span class="n">res_size</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">p_ans</span> <span class="o">=</span> <span class="nf">get_name</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">p_ans</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">p_ans</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p_ans</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">p_ans</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">const</span> <span class="kt">int</span> <span class="n">class</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">p_ans</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p_ans</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">p_ans</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ttl</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">p_ans</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">p_ans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">p_ans</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p_ans</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">p_ans</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">const</span> <span class="kt">int</span> <span class="n">rdlen</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">p_ans</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p_ans</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">p_ans</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">rdlen</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="n">type</span> <span class="o">==</span> <span class="n">A</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%d.%d.%d.%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">p_ans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_ans</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_ans</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_ans</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rdlen</span> <span class="o">==</span> <span class="mi">16</span> <span class="o">&amp;&amp;</span> <span class="n">type</span> <span class="o">==</span> <span class="n">AAAA</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="kt">int</span> <span class="n">j</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">rdlen</span><span class="p">;</span> <span class="n">j</span><span class="o">+=</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%02x%02x&#34;</span><span class="p">,</span> <span class="n">p_ans</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">p_ans</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">rdlen</span><span class="p">)</span> <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">TXT</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\t</span><span class="s">TXT: &#39;%.*s&#39;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">rdlen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_ans</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h1 id="dns-packet-compression">DNS packet compression</h1>
<p>A DNS response is sometimes required to repeat the same name multiple times. In this case, a DNS server may encode a pointer to an earlier name instead of sending the same name multiple times.</p>
<p>A pointer is indicated by a 16-bit value with the two most significant bits set. The lower 14 bits indicate the pointer value. This 14-bit value specifies the location of the name as an offset from the beginning of the message.</p>
<h1 id="transport-protocol">Transport protocol</h1>
<p>By default, DNS uses UDP as default protocol and and DNS query or response should fit well inside one packet. However, if a DNS reponse indicates that the message is truncated, then TCP comes and shines, in this case, we fallback to use TCP to query DNS with the same message format as we do with UDP.</p>
<h1 id="conslusion">Conslusion</h1>
<p><img src="dns-usage-1.png" alt="DNS usage 1"></p>
<p>The implementation is at <a href="https://github.com/trieutrng/dns-protocol">https://github.com/trieutrng/dns-protocol</a></p>
]]></content:encoded>
    </item>
  </channel>
</rss>
